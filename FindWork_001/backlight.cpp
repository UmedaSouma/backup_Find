//===========================================================================================================================================================
// 
// バックライトの処理 [backlight.cpp]
// Author : souma umeda
// 
//===========================================================================================================================================================
#include "backlight.h"

//========================================================================================================================
// コンストラクタ
//========================================================================================================================
CBackLight::CBackLight()
{
}

//========================================================================================================================
// デストラクタ
//========================================================================================================================
CBackLight::~CBackLight()
{
}

//========================================================================================================================
// 初期設定
//========================================================================================================================
HRESULT CBackLight::Init()
{
	SetSize({ 5.0f,5.0f,0.0f });

	CEffect::Init();
	return S_OK;
}

//========================================================================================================================
// 終了処理
//========================================================================================================================
void CBackLight::Uninit()
{
	CEffect::Uninit();
}

//========================================================================================================================
// 更新処理
//========================================================================================================================
void CBackLight::Update()
{
	int life = GetLife();
	int MaxLife = GetMaxLife();
	float LifeRatio = (float)life / (float)MaxLife;	// 最大体力との割合

	if (MaxLife == -1)
	{/* life が -1 の場合は無限体力で消えない */ }
	else
	{// 最大体力との割合でスケールを小さくしていく
		D3DXVECTOR3 scale = { 1.0f,1.0f,1.0f };
		SetScale(scale * LifeRatio);
	}

	CEffect::Update();
}

//========================================================================================================================
// 描画処理
//========================================================================================================================
void CBackLight::Draw()
{
	CEffect::Draw();
}

//========================================================================================================================
// 生成処理
//========================================================================================================================
CBackLight* CBackLight::Create(D3DXVECTOR3 pos, D3DXVECTOR3 rot, int life,bool bRight)
{
	CBackLight* pBackLight = new CBackLight;

	D3DXVECTOR3 posLight = pos;
	float SSize = 10.0f, FBSize = 10.0f;

	// 対角線
	float fLength = sqrtf(SSize * SSize + FBSize * FBSize);
	// 角度
	float fAngle = atan2f(SSize, FBSize);

	// 左右に作りたいので右だったらのif文
	if (bRight) 
	{ fAngle *= -1; }

	// 位置を設定
	posLight.x += sinf(rot.y - fAngle) * fLength;
	posLight.y += 0.0f;
	posLight.z += cosf(rot.y - fAngle) * fLength;

	pBackLight->SetPos(posLight);	// 位置を設定
	pBackLight->SetMaxLife(life);	// 最大体力を設定

	pBackLight->Init();

	return pBackLight;
}