//===========================================================================================================================================================
// 
// フェード遷移の処理
// Author : souma umeda
// 
//===========================================================================================================================================================
#include "fade.h"
#include "manager.h"

////========================================================================================================================
//// コンストラクタ
////========================================================================================================================
//CFade::CFade()
//{
//}

//========================================================================================================================
// コンストラクタ
//========================================================================================================================
CFade::CFade(int nPriority) :CObject2D(nPriority)
{
	m_fFadeframe = 30;
	m_State = FADE_NONE;				// 繊維状態の初期化
	m_NextMode = CScene::MODE_NONE;		// モードの初期化
}

//========================================================================================================================
// デストラクタ
//========================================================================================================================
CFade::~CFade()
{
}

//========================================================================================================================
// 初期設定
//========================================================================================================================
HRESULT CFade::Init()
{
	int nTexIdx = 0;

	//D3DXVECTOR3 CameraPos = CScene::GetCamera()->GetPos();

	//// テクスチャの設定
	//CTexture* pTex = CManager::GetTexture();
	//nTexIdx = pTex->Regist("data\\TEXTURE\\attackrange001.png");
	//BindTexture(pTex->GetAddress(nTexIdx));

	SetColor({ 1.0f,1.0f,1.0f,0.0f });	// 色の設定

	//SetPos({ CameraPos.x,CameraPos.y,0.0f });
	SetPos({SCREEN_WIDTH*0.5f,SCREEN_HEIGHT*0.5f,0.0f });	// 位置の設定
	SetSize({ SCREEN_WIDTH,SCREEN_HEIGHT,0.0f });			// サイズの設定

	SetType(CObject::FADE);	// タイプの設定

	CObject2D::Init();	// オブジェクト2D初期設定

	return S_OK;
}

//========================================================================================================================
// 終了処理
//========================================================================================================================
void CFade::Uninit()
{
	CObject2D::Uninit();
}

//========================================================================================================================
// 更新処理
//========================================================================================================================
void CFade::Update()
{
	if (m_State != FADE_NONE)
	{
		switch (m_State)
		{
		case FADE_IN:
			FadeIn();
			break;

		case FADE_OUT:
			FadeOut();
			break;

		default:
			break;
		}
	}

	CObject2D::Update();
}

//===========================================================================================================
// フェードイン処理
//===========================================================================================================
void CFade::FadeIn()
{
	D3DXCOLOR col = GetColor();

	col.a -= 1.0f / m_fFadeframe;

	if (col.a < 0.0f)
	{
		m_State = FADE_NONE;
	}

	SetColor(col);
}

//===========================================================================================================
// フェードアウト処理
//===========================================================================================================
void CFade::FadeOut()
{
	D3DXCOLOR col = GetColor();

	col.a += 1.0f / m_fFadeframe;

	if (col.a > 1.0f)
	{
		m_State = FADE_IN;
		CManager::SetMode(m_NextMode);
	}

	SetColor(col);
}

//========================================================================================================================
// 描画処理
//========================================================================================================================
void CFade::Draw()
{

	if (m_State != FADE_NONE)
	{
		CObject2D::Draw();
	}

}

//===========================================================================================================
// フェードをセットする
//===========================================================================================================
void CFade::SetFade(CScene::MODE nextmode)
{
	m_NextMode = nextmode;
	m_State = FADE_OUT;
}

//===========================================================================================================
// 状態を取得する
//===========================================================================================================
CFade::STATE CFade::GetState()
{
	return m_State;
}